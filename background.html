<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="jquery-1.7.1.min.js"></script>
    <script>
      // Activation status of this extension. 
      var isActive = false;

      /**
      * Update icon of page action
      * @param {string} tab id
      */
      var updateIcon = function(id){
        if(isActive){
          chrome.pageAction.setIcon({tabId : id, path : "icon_on.png"});
          }else{
          chrome.pageAction.setIcon({tabId : id, path :"icon_off.png"});
        }
      }

      function checkForValidUrl(tabId, changeInfo, tab) {
        if (tab.url.indexOf('http://live.nicovideo.jp') == 0) {
          chrome.pageAction.show(tabId);
          updateIcon(tabId);
        }
      };
      // Listen for any changes to the URL of any tab.
      chrome.tabs.onUpdated.addListener(checkForValidUrl);

      // Message listener for content script
      chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
        if(request.field === 'isActive'){
          sendResponse({isActive: isActive});
        }
      });
    </script>
  </head>
  <body>
  </body>
</html>
